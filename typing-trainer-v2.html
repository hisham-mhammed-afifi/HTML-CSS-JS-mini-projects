<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Typing Training App</title>
    <style>
      /* Global styles and theme variables */
      :root {
        --bg-color: #f5f5f5;
        --text-color: #333;
        --container-bg: #fff;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --correct-color: #22c55e;
        --incorrect-color: #ef4444;
        --current-bg: #fbbf24;
        --button-bg: #3b82f6;
        --button-hover: #2563eb;
      }

      /* Dark theme */
      [data-theme="dark"] {
        --bg-color: #1a1a1a;
        --text-color: #e5e5e5;
        --container-bg: #2a2a2a;
        --shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Header styles */
      header {
        width: 100%;
        max-width: 800px;
        margin-bottom: 30px;
        text-align: center;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      /* Theme toggle button */
      .theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--button-bg);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .theme-toggle:hover {
        background: var(--button-hover);
      }

      /* Main container */
      .container {
        width: 100%;
        max-width: 800px;
        background: var(--container-bg);
        padding: 30px;
        border-radius: 10px;
        box-shadow: var(--shadow);
        transition: background-color 0.3s;
      }

      /* Paragraph display area */
      .paragraph-area {
        font-family: "Courier New", monospace;
        font-size: 1.25rem;
        line-height: 1.8;
        margin-bottom: 30px;
        padding: 20px;
        background: var(--bg-color);
        border-radius: 5px;
        user-select: none;
        min-height: 150px;
      }

      /* Character span styles */
      .char {
        position: relative;
        transition: color 0.1s;
      }

      .char.correct {
        color: var(--correct-color);
      }

      .char.incorrect {
        color: var(--incorrect-color);
      }

      .char.current {
        background-color: var(--current-bg);
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      /* Stats section */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-item {
        text-align: center;
        padding: 15px;
        background: var(--bg-color);
        border-radius: 5px;
      }

      .stat-label {
        font-size: 0.875rem;
        color: var(--text-color);
        opacity: 0.7;
        margin-bottom: 5px;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
      }

      /* Buttons */
      .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      button {
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 500;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
        background: var(--button-bg);
        color: white;
      }

      button:hover {
        background: var(--button-hover);
        transform: translateY(-2px);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      /* Result modal */
      .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--container-bg);
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        text-align: center;
      }

      .modal.show {
        display: block;
      }

      .modal h2 {
        margin-bottom: 20px;
      }

      .modal .final-stats {
        margin-bottom: 30px;
      }

      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }

      .overlay.show {
        display: block;
      }

      /* Loading spinner */
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .loading.show {
        display: block;
      }

      /* Responsive design */
      @media (max-width: 600px) {
        h1 {
          font-size: 2rem;
        }

        .container {
          padding: 20px;
        }

        .paragraph-area {
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()">üåì Theme</button>

    <header>
      <h1>‚å®Ô∏è Typing Training App</h1>
    </header>

    <div class="container">
      <div class="loading" id="loading">Loading paragraphs...</div>

      <div class="paragraph-area" id="paragraphArea"></div>

      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">Time</div>
          <div class="stat-value" id="time">00:00</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">WPM</div>
          <div class="stat-value" id="wpm">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Accuracy</div>
          <div class="stat-value" id="accuracy">100%</div>
        </div>
      </div>

      <div class="button-group">
        <button id="newParagraphBtn" onclick="startNewParagraph()">
          New Paragraph
        </button>
      </div>
    </div>

    <!-- Result Modal -->
    <div class="overlay" id="overlay"></div>
    <div class="modal" id="resultModal">
      <h2>üéâ Paragraph Complete!</h2>
      <div class="final-stats">
        <p><strong>Final Time:</strong> <span id="finalTime"></span></p>
        <p><strong>Final WPM:</strong> <span id="finalWPM"></span></p>
        <p><strong>Final Accuracy:</strong> <span id="finalAccuracy"></span></p>
      </div>
      <button onclick="closeModal()">Try Again</button>
    </div>

    <script>
      // App state management
      let appState = {
        paragraphs: null,
        currentParagraph: "",
        currentIndex: 0,
        startTime: null,
        timerInterval: null,
        correctChars: 0,
        totalTyped: 0,
        isTyping: false,
        isComplete: false,
      };

      // Sound effects (optional - using Web Audio API)
      const audioContext = new (window.AudioContext ||
        window.webkitAudioContext)();

      function playSound(frequency, duration) {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.frequency.value = frequency;
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(
          0.01,
          audioContext.currentTime + duration
        );

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
      }

      // Theme management
      function toggleTheme() {
        const currentTheme =
          document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      }

      // Initialize theme from localStorage
      const savedTheme = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", savedTheme);

      // Fetch paragraphs from JSON file
      async function fetchParagraphs() {
        try {
          document.getElementById("loading").classList.add("show");
          const response = await fetch("./paragraphs-list.json");

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          appState.paragraphs = await response.json();
          document.getElementById("loading").classList.remove("show");

          // Start with a random paragraph
          startNewParagraph();
        } catch (error) {
          console.error("Error loading paragraphs:", error);
          document.getElementById("loading").textContent =
            "Error loading paragraphs. Please check the JSON file.";

          // Fallback paragraphs for demo
          appState.paragraphs = {
            1: "The quick brown fox jumps over the lazy dog.",
            2: "Typing is a skill you can improve every day.",
            3: "Practice makes perfect when learning to type faster.",
            4: "Focus on accuracy first, then speed will naturally follow.",
            5: "Keep your fingers on the home row for better typing.",
          };

          document.getElementById("loading").classList.remove("show");
          startNewParagraph();
        }
      }

      // Select and display a random paragraph
      function startNewParagraph() {
        if (!appState.paragraphs) return;

        // Reset state
        resetState();

        // Select random paragraph
        const keys = Object.keys(appState.paragraphs);
        const randomKey = keys[Math.floor(Math.random() * keys.length)];
        appState.currentParagraph = appState.paragraphs[randomKey];

        // Display paragraph with spans
        displayParagraph();

        // Enable typing
        document.getElementById("newParagraphBtn").disabled = false;
      }

      // Reset app state
      function resetState() {
        appState.currentIndex = 0;
        appState.startTime = null;
        appState.correctChars = 0;
        appState.totalTyped = 0;
        appState.isTyping = false;
        appState.isComplete = false;

        // Clear timer
        if (appState.timerInterval) {
          clearInterval(appState.timerInterval);
          appState.timerInterval = null;
        }

        // Reset display
        document.getElementById("time").textContent = "00:00";
        document.getElementById("wpm").textContent = "0";
        document.getElementById("accuracy").textContent = "100%";
      }

      // Display paragraph with character spans
      function displayParagraph() {
        const paragraphArea = document.getElementById("paragraphArea");
        paragraphArea.innerHTML = "";

        // Create spans for each character
        for (let i = 0; i < appState.currentParagraph.length; i++) {
          const span = document.createElement("span");
          span.className = "char";
          span.textContent = appState.currentParagraph[i];

          if (i === 0) {
            span.classList.add("current");
          }

          paragraphArea.appendChild(span);
        }
      }

      // Handle keyboard input
      document.addEventListener("keydown", handleKeyPress);

      function handleKeyPress(event) {
        // Ignore if complete or no paragraph loaded
        if (appState.isComplete || !appState.currentParagraph) return;

        // Prevent special keys
        if (
          event.key === "Backspace" ||
          event.key === "Delete" ||
          event.key === "ArrowLeft" ||
          event.key === "ArrowRight" ||
          event.key === "ArrowUp" ||
          event.key === "ArrowDown" ||
          event.key === "Enter" ||
          event.ctrlKey ||
          event.metaKey
        ) {
          event.preventDefault();
          return;
        }

        // Only process printable characters
        if (event.key.length !== 1) return;

        // Start timer on first keypress
        if (!appState.isTyping) {
          startTimer();
          appState.isTyping = true;
        }

        // Process character
        processCharacter(event.key);
      }

      // Process typed character
      function processCharacter(typedChar) {
        const chars = document.querySelectorAll(".char");
        const currentChar = appState.currentParagraph[appState.currentIndex];

        // Update total typed
        appState.totalTyped++;

        // Check if correct
        if (typedChar === currentChar) {
          chars[appState.currentIndex].classList.add("correct");
          appState.correctChars++;
          playSound(800, 0.1); // High pitch for correct
        } else {
          chars[appState.currentIndex].classList.add("incorrect");
          playSound(300, 0.2); // Low pitch for incorrect
        }

        // Remove current highlight
        chars[appState.currentIndex].classList.remove("current");

        // Move to next character
        appState.currentIndex++;

        // Check if complete
        if (appState.currentIndex >= appState.currentParagraph.length) {
          completeTyping();
        } else {
          // Highlight next character
          chars[appState.currentIndex].classList.add("current");
        }

        // Update stats
        updateStats();
      }

      // Start timer
      function startTimer() {
        appState.startTime = Date.now();

        appState.timerInterval = setInterval(() => {
          const elapsed = Date.now() - appState.startTime;
          const minutes = Math.floor(elapsed / 60000);
          const seconds = Math.floor((elapsed % 60000) / 1000);

          document.getElementById("time").textContent = `${minutes
            .toString()
            .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

          // Update WPM in real-time
          updateStats();
        }, 100);
      }

      // Update statistics
      function updateStats() {
        if (!appState.startTime) return;

        const elapsed = (Date.now() - appState.startTime) / 1000 / 60; // minutes

        // Calculate WPM (1 word = 5 characters)
        const wpm =
          elapsed > 0 ? Math.round(appState.correctChars / 5 / elapsed) : 0;
        document.getElementById("wpm").textContent = wpm;

        // Calculate accuracy
        const accuracy =
          appState.totalTyped > 0
            ? Math.round((appState.correctChars / appState.totalTyped) * 100)
            : 100;
        document.getElementById("accuracy").textContent = `${accuracy}%`;
      }

      // Complete typing session
      function completeTyping() {
        appState.isComplete = true;
        clearInterval(appState.timerInterval);

        // Show final stats
        const finalTime = document.getElementById("time").textContent;
        const finalWPM = document.getElementById("wpm").textContent;
        const finalAccuracy = document.getElementById("accuracy").textContent;

        document.getElementById("finalTime").textContent = finalTime;
        document.getElementById("finalWPM").textContent = finalWPM;
        document.getElementById("finalAccuracy").textContent = finalAccuracy;

        // Show modal
        document.getElementById("overlay").classList.add("show");
        document.getElementById("resultModal").classList.add("show");

        // Play completion sound
        playSound(600, 0.1);
        setTimeout(() => playSound(800, 0.1), 100);
        setTimeout(() => playSound(1000, 0.2), 200);
      }

      // Close result modal
      function closeModal() {
        document.getElementById("overlay").classList.remove("show");
        document.getElementById("resultModal").classList.remove("show");
        startNewParagraph();
      }

      // Initialize app on load
      window.addEventListener("load", () => {
        fetchParagraphs();
      });
    </script>
  </body>
</html>
